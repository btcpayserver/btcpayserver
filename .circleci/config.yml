version: 2
jobs:
  build:
    machine: 
      enabled: true
    steps: 
      - checkout
  test:
    machine: true
    steps:
      - checkout
      - run:
          command: |
            lsb_release -a

            sudo apt update
            sudo apt install -y qemu qemu-user-static qemu-user binfmt-support

            docker run --rm --privileged multiarch/qemu-user-static:register --reset

            docker build --pull -t dotnetapp -f Dockerfile.debian-arm32-selfcontained .
workflows:
  version: 2
  build_and_test:
    jobs:
      - test

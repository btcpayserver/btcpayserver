version: 2
jobs:
  build:
    machine:
      docker_layer_caching: true
    steps: 
      - checkout
      - run:
        command: |
          lsb_release -a
          sudo apt update
          sudo apt install -y qemu qemu-user-static qemu-user binfmt-support
          sudo docker run --rm --privileged multiarch/qemu-user-static:register --reset
      - run: sudo docker build --pull -t BtcPayServerArm32 -f Dockerfile.bionic-arm32 .   
  test:
    machine: true
    steps:
      - checkout   
workflows:
  version: 2
  build_and_test:
    jobs:
      - test

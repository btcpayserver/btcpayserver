@model WalletSetupViewModel
@addTagHelper *, BundlerMinifier.TagHelpers
@{
    Layout = "_LayoutWalletSetup";
    ViewData["Title"] = "Scan QR code";
}

@section Navbar {
    <a asp-controller="Stores" asp-action="ImportWallet" asp-route-storeId="@Model.StoreId" asp-route-cryptoCode="@Model.CryptoCode" asp-route-method="">
        <vc:icon symbol="back" />
    </a>
}

<header class="text-center">
    <h1>@ViewData["Title"]</h1>
</header>

@if (!ViewContext.ModelState.IsValid)
{
    <div asp-validation-summary="All" class="text-danger"></div>
}

<partial name="CameraScanner"/>

<form id="qr-import-form" method="post">
    <input asp-for="WalletFileContent" type="hidden" />
</form>

@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")

    <bundle name="wwwroot/bundles/camera-bundle.min.js"></bundle>
    <link href="~/vendor/vue-qrcode-reader/vue-qrcode-reader.css" rel="stylesheet" asp-append-version="true"/>

    <script type="text/javascript">
        window.coinName = "@Model.Network.DisplayName.ToLowerInvariant()";
        window.addEventListener("load", async () => {
            initCameraScanningApp("Scan wallet QR", data => {
                document.getElementById("WalletFileContent").value = data;
                document.getElementById("qr-import-form").submit();
            }, "scanqrModal");

            $("#scanqrModal").modal();
        });
    </script>
}

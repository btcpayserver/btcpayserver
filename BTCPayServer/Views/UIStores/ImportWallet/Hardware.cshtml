@using BTCPayServer.Security
@using BTCPayServer.TagHelpers
@using Microsoft.AspNetCore.Mvc.TagHelpers
@model WalletSetupViewModel

@{
    Layout = "_LayoutWalletSetup";
    ViewData.SetActivePage(StoreNavPages.OnchainSettings, StringLocalizer["Connect your hardware wallet"], $"{Context.GetStoreData().Id}-{Model.CryptoCode}");
    this.ViewData.SetBlazorAllowed(true);
}

@section Navbar {
    <a asp-controller="UIStores" asp-action="ImportWallet" asp-route-storeId="@Model.StoreId" asp-route-cryptoCode="@Model.CryptoCode" asp-route-method="">
        <vc:icon symbol="back" />
    </a>
}

<header class="text-center">
    <h1>@ViewData["Title"]</h1>
    <p class="lead text-secondary mt-3" text-translate="true">In order to securely connect to your hardware wallet you must first download, install, and run the BTCPay Server Vault.</p>
</header>

@if (!ViewContext.ModelState.IsValid)
{
    <div asp-validation-summary="All"></div>
}

<div class="row mt-5 mb-4">
    <div class="col-md-8 mx-auto">
        <component type="typeof(BTCPayServer.Blazor.VaultBridgeUI)" param-CryptoCode="@Context.GetRouteValue("cryptoCode")" render-mode="Server"/>
    </div>
</div>

<form method="post" id="walletInfo" style="display:none;">
    <input asp-for="Config" type="hidden" />
    <input asp-for="CryptoCode" type="hidden" />
    <input asp-for="AccountKey" type="hidden" />
    <input asp-for="Source" type="hidden" value="Vault"/>
    <input asp-for="DerivationSchemeFormat" type="hidden" value="BTCPay" />

    <div class="row mb-5">
        <div class="col-md-8 mx-auto">
            <h4 class="mb-3" text-translate="true">Public Key Information</h4>
            <div class="form-group">
                <label asp-for="DerivationScheme" class="form-label"></label>
                <textarea asp-for="DerivationScheme" class="form-control store-derivation-scheme font-monospace py-2" rows="3" readonly></textarea>
            </div>
            <div class="form-group">
                <label asp-for="RootFingerprint" class="form-label"></label>
                <input asp-for="RootFingerprint" class="form-control" readonly />
            </div>
            <div class="form-group">
                <label asp-for="KeyPath" class="form-label"></label>
                <input asp-for="KeyPath" class="form-control" readonly />
            </div>
            <button name="command" type="submit" class="btn btn-primary" value="save" id="Continue" text-translate="true">Continue</button>
        </div>
    </div>
</form>

@section PageFootContent {
    <partial name="_ValidationScriptsPartial" />

    <script src="~/js/vaultbridge2.js" asp-append-version="true"></script>
    <script>
        vault.setXPub = function (xpub)
        {
            $("#DerivationScheme").val(xpub.strategy);
            $("#RootFingerprint").val(xpub.fingerprint);
            $("#AccountKey").val(xpub.accountKey);
            $("#Source").val("Vault");
            $("#DerivationSchemeFormat").val("BTCPay");
            $("#KeyPath").val(xpub.keyPath);
            $("#walletInfo").show();
        }
    </script>
}


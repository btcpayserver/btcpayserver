@model WalletLabelsModel
@{
    var walletId = Context.GetRouteValue("walletId").ToString();
    var cryptoCode = Model.WalletId.CryptoCode;
    ViewData.SetLayoutModel(new LayoutModel($"{nameof(WalletsNavPages.Settings)}-{cryptoCode}", StringLocalizer["{0} Wallet Labels", Model.WalletId.CryptoCode])
        .SetCategory(WellKnownCategories.ForWallet(cryptoCode)));
}

@section PageFootContent {
    <script>
        delegate('click', '.btn-delete', event => {
            event.preventDefault()
        })
        
        delegate('click', '.btn-edit', event => {
            const button = event.target.closest('.btn-edit')
            const label = button.dataset.label
            const modal = document.getElementById('EditLabelModal')
            const input = modal.querySelector('#EditLabelInput')
            const form = modal.querySelector('form')
            const oldLabelInput = modal.querySelector('#OldLabel')
            const walletId = '@walletId'
            
            input.value = label
            oldLabelInput.value = label
            form.action = `/wallets/${walletId}/labels/${encodeURIComponent(label)}/edit`
            
            new bootstrap.Modal(modal).show()
        })
    </script>
}

<div class="sticky-header">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a asp-action="WalletTransactions" asp-controller="UIWallets" asp-route-walletId="@walletId" text-translate="true">Transactions</a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">Labels</li>
        </ol>
        <h2>@ViewData["Title"]</h2>
    </nav>
</div>

<partial name="_StatusMessage" />

@if (Model.Labels.Any())
{
    <div class="table-responsive-md">
        <table class="table table-hover">
            <thead>
            <tr>
                <th text-translate="true">Label</th>
                <th text-translate="true" class="text-end">Actions</th>
            </tr>
            </thead>
            <tbody>
            @foreach (var label in Model.Labels)
            {
                <tr>
                    <td>
                        <div class="transaction-label" style="--label-bg:@label.Color;--label-fg:@label.TextColor">
                            <span>@label.Label</span>
                        </div>
                    </td>

                    <td class="text-end">
                        <a class="btn btn-link p-0 me-3"
                           href="@Url.Action("ReservedAddresses", "UIWallets", new { walletId = Model.WalletId.ToString(), filter = label.Label })"
                           title="View Reserved Addresses with this label">
                            Addresses
                        </a>
                        <button class="btn btn-link btn-edit p-0 me-3" type="button"
                                data-label="@label.Label" text-translate="true">Edit
                        </button>
                        <form method="post" asp-action="DeleteWalletLabel" asp-route-walletId="@Model.WalletId" asp-route-id="@label.Label"
                              class="d-inline">
                            <button class="btn btn-link btn-delete p-0 me-3" type="submit" data-bs-toggle="modal" data-bs-target="#ConfirmModal"
                                    data-description="@StringLocalizer["The label {0} will be deleted from this wallet and its associated transactions.", Html.Encode(label.Label)]"
                                    data-confirm-input="@StringLocalizer["DELETE"]" text-translate="true">Delete
                            </button>
                        </form>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
    <partial name="_Confirm"
             model="@(new ConfirmModel(StringLocalizer["Delete label"],
    StringLocalizer["This label will be deleted from this wallet and its associated transactions."], StringLocalizer["Delete"]))" />
    
    <div class="modal fade" id="EditLabelModal" tabindex="-1" aria-labelledby="EditLabelModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <form method="post" asp-action="EditWalletLabel" asp-route-walletId="@Model.WalletId">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="EditLabelModalLabel" text-translate="true">Edit Label</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="OldLabel" name="id" />
                        <div class="form-group">
                            <label for="EditLabelInput" class="form-label" text-translate="true">Label Name</label>
                            <input type="text" class="form-control" id="EditLabelInput" name="newLabel" required maxlength="50" />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" text-translate="true">Cancel</button>
                        <button type="submit" class="btn btn-primary" text-translate="true">Save</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
}
else
{
    <p class="text-secondary mt-3">
        @ViewLocalizer["There are no custom labels yet. You can create custom labels by assigning them to your {0}.",
            Html.ActionLink(StringLocalizer["transactions"],
                "WalletTransactions", "UIWallets", new { walletId })]
    </p>
}
